# Spring Boot + R2DBC PoC project

Simple "Proof of Concept" project used to experiment using [R2DBC](https://r2dbc.io/) on [PostgreSQL](https://github.com/r2dbc/r2dbc-postgresql) along with [Spring WebFlux](https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/web-reactive.html).

## Running it

This project has been developed using [Maven](https://maven.apache.org/) and [Spring Boot](https://projects.spring.io/spring-boot/) and can be executed using:

 > ./mvnw spring-boot:run

It requires a [PostgreSQL](https://www.postgresql.org/). A [docker-compose.yml](docker-compose.yml) is provided so one can run a PostgreSQL instance in a Docker container executing, for example:

 > docker-compose up --remove-orphans --force-recreate --build

Database's schema is automatically generated by [Liquibase](https://www.liquibase.org/) during application startup.

## Using it

Once it is up and running a `Person` record can be created using REST API, as for example, using [HTTPie](https://httpie.org/):

    $ http :8080/persons name="John Doo" birthday=1980-05-29
    HTTP/1.1 200 OK
    Content-Length: 50
    Content-Type: application/json;charset=UTF-8
    
    {
        "birthday": "1980-05-29",
        "id": 4,
        "name": "John Doo"
    }

And then listing:

    $ http :8080/persons
    HTTP/1.1 200 OK
    Content-Type: application/json;charset=UTF-8
    transfer-encoding: chunked
    
    [
        {
            "birthday": "1980-05-29",
            "id": 4,
            "name": "John Doo#4"
        },
        {
            "birthday": "1984-11-01",
            "id": 5,
            "name": "Foo Bar#5"
        }
    ]

### SSE ([Server Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events) / streamed `application/stream+json`)


    $ http -S :8080/greetings
    HTTP/1.1 200 OK
    Content-Type: application/stream+json;charset=UTF-8
    transfer-encoding: chunked
    
    {
        "at": "2019-03-30T10:45:27.129Z", 
        "id": "bbd7e5fe-09b8-473a-9e80-1d5489cdafb5@reactor-http-epoll-8", 
        "source": "reactor-http-epoll-8"
    }
    {
        "at": "2019-03-30T10:45:28.131Z", 
        "id": "bbd7e5fe-09b8-473a-9e80-1d5489cdafb5@reactor-http-epoll-8", 
        "source": "parallel-2"
    }

### HTTP2 

The application also supports HTTP2 protocol

    $ curl --http2 -i http://localhost:8080/persons
    HTTP/1.1 101 Switching Protocols
    connection: upgrade
    upgrade: h2c
    
    HTTP/2 200 
    content-type: application/json;charset=UTF-8
    
    [ {
      "id" : 5,
      "name" : "Foo Bar#5",
      "birthday" : "1984-11-01"
    }, {
      "id" : 4,
      "name" : "John Doo#4",
      "birthday" : "1980-05-29"
    }, {
      "id" : 6,
      "name" : "John Doo#6",
      "birthday" : "1980-05-29"
    }, {
      "id" : 7,
      "name" : "John Doo#7",
      "birthday" : "1980-05-29"
    } ]